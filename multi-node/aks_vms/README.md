
## Best Rate using Azure Kubernetes Service (Managed Cluster VM's)

This test uses the VM's created by AKS and verifies that with tuning these VM's can also achieve the same rate as our previous tests using CentOS.

Using 12 D16sv3 nodes.

Added a Public IP to node 0 and modified security to allow ssh into that node.

Used the PKI used during AKS install to ssh into node 0.

**Note**: AKS uses Ubuntu 18.04 VM's the testing we did on VM's was done using CentOS VM's.

### Installing 

Tried to tweak and use Ansible scripts where possible to install Elasticsearch, Spark, Kafka, and Test tools.

### Run Spark Job

From node-0 ssh'd into one of Spark nodes and became spark user (sudo su - spark).

```
/opt/spark/bin/spark-submit \
  --conf spark.executor.cores=5 \
  --conf spark.cores.max=45 \
  --conf spark.executor.memory=5000m \
  --conf spark.es.batch.size.bytes=421000000 \
  --conf spark.es.batch.size.entries=50000 \
  --conf spark.es.batch.write.refresh=false \
  --conf spark.streaming.concurrentJobs=64 \
  --conf spark.scheduler.mode=FAIR \
  --conf spark.locality.wait=0s  \
  --conf spark.streaming.kafka.consumer.cache.enabled=false \
  --class org.jennings.estest.SendKafkaTopicElasticsearch /home/spark/sparktest/target/sparktest-full.jar \
  spark://aks-nodepool1-64873208-9:7077 1000 aks-nodepool1-64873208-3:9092 group1 planes9 1 \
  aks-nodepool1-64873208-7 9200 - - 9 true false true planes 60s 10000 0 false
```

### Run ElasticIndexMon

From one of test nodes

```
cd rttest
java -cp target/rttest.jar com.esri.rttest.mon.ElasticIndexMon http://aks-nodepool1-64873208-7:9200/planes 10 12
```

### Run KafkaTopicMone

From one of test nodes

```
cd rttest
java -cp target/rttest.jar com.esri.rttest.mon.KafkaTopicMon aks-nodepool1-64873208-3:9092 planes9
```

### Send Message

From one of test nodes

If not already done download test data

```
cd rttest
curl -O https://s3.amazonaws.com/esriplanes/lat88/withhashes/planes00000
```

Now send messages

```
bash sendPlanes aks-nodepool1-64873208-3:9092 planes9 planes00000 200 75 1
```


### Without Elasticseach Tuning

These first tests were done without tuning Elasticsearch nodes
- jvm.options Xmx/Xms was 1G


I had to lower batch byte size and entries by factor of 10.  Without this change the Spark job through errors "Data too large".  This errors were returned periodically when getting a count from planes.

Modified Spark Job

```
/opt/spark/bin/spark-submit \
  --conf spark.executor.cores=5 \
  --conf spark.cores.max=45 \
  --conf spark.executor.memory=5000m \
  --conf spark.es.batch.size.bytes=42100000 \
  --conf spark.es.batch.size.entries=5000 \
  --conf spark.es.batch.write.refresh=false \
  --conf spark.streaming.concurrentJobs=64 \
  --conf spark.scheduler.mode=FAIR \
  --conf spark.locality.wait=0s  \
  --conf spark.streaming.kafka.consumer.cache.enabled=false \
  --class org.jennings.estest.SendKafkaTopicElasticsearch /home/spark/sparktest/target/sparktest-full.jar \
  spark://aks-nodepool1-64873208-9:7077 1000 aks-nodepool1-64873208-3:9092 group1 planes9 1 \
  aks-nodepool1-64873208-7 9200 - - 9 true false true planes 60s 10000 0 false
```

Results
- Send 1x200k/s
- KTM: 200k/s
- EIM: Started over 100k/s at 1 min; 86k/s at 10 min 

|Query Number|Sample Number|Epoch (ms)    |Time (s) |Count             |Linear Reg. Rate  |Rate From Previous|Rate From First   |
|------------|-------------|--------------|---------|------------------|------------------|------------------|------------------|
|          1 |           1 |1557152647175 |       0 |        6,083,901 |                  |                  |                  |
|          2 |       ***** |1557152657182 |      10 |        6,083,901 |                  |                  |                  |
|          3 |       ***** |1557152667297 |      20 |        6,083,901 |                  |                  |                  |
|          4 |       ***** |1557152677177 |      30 |        6,083,901 |                  |                  |                  |
|          5 |       ***** |1557152687201 |      40 |        6,083,901 |                  |                  |                  |
|          6 |       ***** |1557152697190 |      50 |        6,083,901 |                  |                  |                  |
|          7 |           2 |1557152707175 |      60 |       13,320,669 |          120,613 |          120,613 |          120,613 |
|          8 |       ***** |1557152717176 |      70 |       13,320,669 |          120,613 |                0 |          103,381 |
|          9 |       ***** |1557152727176 |      80 |       13,320,669 |          120,613 |                0 |           90,458 |
|         10 |       ***** |1557152737177 |      90 |       13,320,669 |          120,613 |                0 |           80,407 |
|         11 |       ***** |1557152747175 |     100 |       13,320,669 |          120,613 |                0 |           72,368 |
|         12 |       ***** |1557152757180 |     110 |       13,320,669 |          120,613 |                0 |           65,786 |
|         13 |           3 |1557152767181 |     120 |       17,852,312 |           98,065 |           75,520 |           98,065 |
|         14 |       ***** |1557152777176 |     130 |       17,852,312 |           98,065 |                0 |           90,526 |
|         15 |       ***** |1557152787175 |     140 |       17,852,312 |           98,065 |                0 |           84,060 |
|         16 |       ***** |1557152797224 |     150 |       17,852,312 |           98,065 |                0 |           78,430 |
|         17 |       ***** |1557152807176 |     160 |       17,852,312 |           98,065 |                0 |           73,552 |
|         18 |       ***** |1557152817217 |     170 |       17,852,312 |           98,065 |                0 |           69,209 |
|         19 |           4 |1557152827176 |     180 |       22,802,334 |           91,144 |           82,507 |           92,880 |
|         20 |           5 |1557152837187 |     190 |       23,416,813 |           88,949 |           61,380 |           91,220 |
|         21 |       ***** |1557152847190 |     200 |       23,416,813 |           88,949 |                0 |           86,658 |
|         22 |       ***** |1557152857177 |     210 |       23,416,813 |           88,949 |                0 |           82,537 |
|         23 |       ***** |1557152867235 |     220 |       23,416,813 |           88,949 |                0 |           78,764 |
|         24 |       ***** |1557152877177 |     230 |       23,416,813 |           88,949 |                0 |           75,360 |
|         25 |           6 |1557152887179 |     240 |       25,513,744 |           81,531 |           41,945 |           80,956 |
|         26 |           7 |1557152897177 |     250 |       29,700,120 |           85,206 |          418,721 |           94,464 |
|         27 |       ***** |1557152907180 |     260 |       29,700,120 |           85,206 |                0 |           90,830 |
|         28 |       ***** |1557152917176 |     270 |       29,700,120 |           85,206 |                0 |           87,467 |
|         29 |       ***** |1557152927176 |     280 |       29,700,120 |           85,206 |                0 |           84,343 |
|         30 |       ***** |1557152937179 |     290 |       29,700,120 |           85,206 |                0 |           81,434 |
|         31 |           8 |1557152947178 |     300 |       29,994,063 |           80,209 |            5,879 |           79,700 |
|         32 |           9 |1557152957177 |     310 |       32,389,277 |           80,032 |          239,545 |           84,856 |
|         33 |       ***** |1557152967515 |     320 |       32,389,277 |           80,032 |                0 |           82,117 |
|         34 |       ***** |1557152977187 |     330 |       32,389,277 |           80,032 |                0 |           79,710 |
|         35 |       ***** |1557152987182 |     340 |       32,389,277 |           80,032 |                0 |           77,367 |
|         36 |       ***** |1557152997177 |     350 |       32,389,277 |           80,032 |                0 |           75,158 |
|         37 |       ***** |1557153007200 |     360 |       32,389,277 |           80,032 |                0 |           73,065 |
|         38 |          10 |1557153017179 |     370 |       39,494,306 |           83,091 |          118,413 |           90,297 |
|         39 |       ***** |1557153027180 |     380 |       39,494,306 |           83,091 |                0 |           87,921 |
|         40 |       ***** |1557153037178 |     390 |       39,494,306 |           83,091 |                0 |           85,667 |
|         41 |       ***** |1557153047179 |     400 |       39,494,306 |           83,091 |                0 |           83,525 |
|         42 |       ***** |1557153057182 |     410 |       39,494,306 |           83,091 |                0 |           81,487 |
|         43 |       ***** |1557153067179 |     420 |       39,494,306 |           83,091 |                0 |           79,548 |
|         44 |          11 |1557153077185 |     430 |       43,528,186 |           83,737 |           67,225 |           87,078 |
|         45 |       ***** |1557153087180 |     440 |       43,528,186 |           83,737 |                0 |           85,100 |
|         46 |       ***** |1557153097180 |     450 |       43,528,186 |           83,737 |                0 |           83,209 |
|         47 |       ***** |1557153107179 |     460 |       43,528,186 |           83,737 |                0 |           81,400 |
|         48 |       ***** |1557153117181 |     470 |       43,528,186 |           83,737 |                0 |           79,668 |
|         49 |       ***** |1557153127234 |     480 |       43,528,186 |           83,737 |                0 |           77,999 |
|         50 |          12 |1557153137182 |     490 |       47,818,658 |           83,330 |           71,511 |           85,172 |
|         51 |       ***** |1557153147180 |     500 |       47,818,658 |           83,330 |                0 |           83,469 |
|         52 |       ***** |1557153157857 |     510 |       47,818,658 |           83,330 |                0 |           81,724 |
|         53 |       ***** |1557153167183 |     520 |       47,818,658 |           83,330 |                0 |           80,258 |
|         54 |       ***** |1557153177196 |     530 |       47,818,658 |           83,330 |                0 |           78,742 |
|         55 |       ***** |1557153187179 |     540 |       47,818,658 |           83,330 |                0 |           77,286 |
|         56 |          13 |1557153197180 |     550 |       52,812,045 |           83,099 |           83,226 |           84,959 |
|         57 |          14 |1557153207179 |     560 |       54,239,635 |           83,383 |          142,773 |           85,992 |
|         58 |       ***** |1557153217183 |     570 |       54,239,635 |           83,383 |                0 |           84,483 |
|         59 |       ***** |1557153227180 |     580 |       54,239,635 |           83,383 |                0 |           83,026 |
|         60 |       ***** |1557153237181 |     590 |       54,239,635 |           83,383 |                0 |           81,619 |
|         61 |       ***** |1557153247180 |     600 |       54,239,635 |           83,383 |                0 |           80,259 |
|         62 |          15 |1557153257179 |     610 |       54,980,188 |           81,499 |           14,811 |           80,157 |
|         63 |          16 |1557153267179 |     620 |       55,879,664 |           80,378 |           89,948 |           80,315 |
|         64 |       ***** |1557153277180 |     630 |       55,879,664 |           80,378 |                0 |           79,040 |
|         65 |       ***** |1557153287179 |     640 |       55,879,664 |           80,378 |                0 |           77,805 |
|         66 |       ***** |1557153297182 |     650 |       55,879,664 |           80,378 |                0 |           76,608 |
|         67 |       ***** |1557153307181 |     660 |       55,879,664 |           80,378 |                0 |           75,447 |
|         68 |       ***** |1557153317180 |     670 |       55,879,664 |           80,378 |                0 |           74,321 |
|         69 |       ***** |1557153327181 |     680 |       55,879,664 |           80,378 |                0 |           73,228 |
|         70 |       ***** |1557153337180 |     690 |       55,879,664 |           80,378 |                0 |           72,167 |
|         71 |       ***** |1557153347180 |     700 |       55,879,664 |           80,378 |                0 |           71,136 |
|         72 |       ***** |1557153357181 |     710 |       55,879,664 |           80,378 |                0 |           70,134 |
|         73 |       ***** |1557153367180 |     720 |       55,879,664 |           80,378 |                0 |           69,160 |
|         74 |       ***** |1557153377183 |     730 |       55,879,664 |           80,378 |                0 |           68,213 |

For last 120  seconds the count has not increased...
Removing sample: 740|55879664
Total Count: 55,879,664 | Linear Regression Rate:  81,499 | Linear Regression Standard Error: 1.94 | Average Rate: 80,157

### Tuned Elasticsearch
- Updated jvm.options (set Xmx/Xms to 26G; up from default 1G)
- Changed /etc/security/limits (Added elasticsearch - nofile 65536)
- Changed /etc/sysctl.conf added 
  vm.max_map_count=262144
  vm.swappiness=1

Reran test 

|Query Number|Sample Number|Epoch (ms)    |Time (s) |Count             |Linear Reg. Rate  |Rate From Previous|Rate From First   |
|------------|-------------|--------------|---------|------------------|------------------|------------------|------------------|
|          1 |           1 |1557154027222 |       0 |        3,039,244 |                  |                  |                  |
|          2 |       ***** |1557154037200 |       9 |        3,039,244 |                  |                  |                  |
|          3 |       ***** |1557154047208 |      19 |        3,039,244 |                  |                  |                  |
|          4 |       ***** |1557154057196 |      29 |        3,039,244 |                  |                  |                  |
|          5 |       ***** |1557154074165 |      46 |        3,039,244 |                  |                  |                  |
|          6 |       ***** |1557154077196 |      49 |        3,039,244 |                  |                  |                  |
|          7 |           2 |1557154087191 |      59 |        7,824,080 |           79,788 |           79,788 |           79,788 |
|          8 |           3 |1557154097192 |      69 |        9,173,260 |           84,919 |          134,905 |           87,666 |
|          9 |       ***** |1557154107198 |      79 |        9,173,260 |           84,919 |                0 |           76,698 |
|         10 |       ***** |1557154117192 |      89 |        9,173,260 |           84,919 |                0 |           68,178 |
|         11 |       ***** |1557154127192 |      99 |        9,173,260 |           84,919 |                0 |           61,359 |
|         12 |       ***** |1557154137194 |     109 |        9,173,260 |           84,919 |                0 |           55,778 |
|         13 |           4 |1557154147194 |     119 |        9,324,366 |           54,365 |            3,022 |           52,388 |
|         14 |           5 |1557154157194 |     129 |        9,385,737 |           46,333 |            6,137 |           48,830 |
|         15 |       ***** |1557154167197 |     139 |        9,385,737 |           46,333 |                0 |           45,340 |
|         16 |       ***** |1557154177792 |     150 |        9,385,737 |           46,333 |                0 |           42,150 |
|         17 |       ***** |1557154187198 |     159 |        9,385,737 |           46,333 |                0 |           39,672 |
|         18 |       ***** |1557154197191 |     169 |        9,385,737 |           46,333 |                0 |           37,339 |
|         19 |           6 |1557154207197 |     179 |        9,943,258 |           34,919 |           11,150 |           38,361 |
|         20 |           7 |1557154217198 |     189 |       13,945,411 |           42,200 |          400,175 |           57,408 |
|         21 |           8 |1557154227236 |     200 |       14,552,550 |           46,058 |           60,484 |           57,563 |
|         22 |       ***** |1557154237194 |     209 |       14,552,550 |           46,058 |                0 |           54,833 |
|         23 |       ***** |1557154247197 |     219 |       14,552,550 |           46,058 |                0 |           52,339 |
|         24 |       ***** |1557154257192 |     229 |       14,552,550 |           46,058 |                0 |           50,064 |
|         25 |       ***** |1557154267192 |     239 |       14,552,550 |           46,058 |                0 |           47,978 |
|         26 |           9 |1557154277196 |     249 |       16,924,934 |           48,886 |           47,486 |           55,549 |
|         27 |          10 |1557154287194 |     259 |       18,741,135 |           52,542 |          181,656 |           60,398 |
|         28 |       ***** |1557154297194 |     269 |       18,741,135 |           52,542 |                0 |           58,161 |
|         29 |       ***** |1557154307199 |     279 |       18,741,135 |           52,542 |                0 |           56,083 |
|         30 |       ***** |1557154317197 |     289 |       18,741,135 |           52,542 |                0 |           54,149 |
|         31 |       ***** |1557154327198 |     299 |       18,741,135 |           52,542 |                0 |           52,344 |
|         32 |          11 |1557154337197 |     309 |       19,879,372 |           52,504 |           22,763 |           54,327 |
|         33 |          12 |1557154347199 |     319 |       22,862,584 |           55,660 |          298,262 |           61,952 |
|         34 |          13 |1557154357197 |     329 |       24,294,085 |           58,482 |          143,179 |           64,413 |
|         35 |       ***** |1557154367199 |     339 |       24,294,085 |           58,482 |                0 |           62,518 |
|         36 |       ***** |1557154377200 |     349 |       24,294,085 |           58,482 |                0 |           60,732 |
|         37 |       ***** |1557154387203 |     359 |       24,294,085 |           58,482 |                0 |           59,044 |
|         38 |       ***** |1557154397196 |     369 |       24,294,085 |           58,482 |                0 |           57,450 |
|         39 |          14 |1557154407198 |     379 |       26,691,113 |           60,087 |           47,940 |           62,246 |
|         40 |          15 |1557154417196 |     389 |       27,825,730 |           61,525 |          113,484 |           63,559 |
|         41 |       ***** |1557154427196 |     399 |       27,825,730 |           61,525 |                0 |           61,970 |
|         42 |       ***** |1557154437197 |     409 |       27,825,730 |           61,525 |                0 |           60,459 |
|         43 |       ***** |1557154447198 |     419 |       27,825,730 |           61,525 |                0 |           59,019 |
|         44 |       ***** |1557154457197 |     429 |       27,825,730 |           61,525 |                0 |           57,646 |
|         45 |          16 |1557154467201 |     439 |       29,553,612 |           61,474 |           34,554 |           60,263 |
|         46 |          17 |1557154477208 |     449 |       31,644,043 |           62,478 |          208,897 |           63,568 |
|         47 |          18 |1557154487197 |     459 |       32,261,944 |           63,157 |           61,858 |           63,531 |
|         48 |       ***** |1557154497198 |     469 |       32,261,944 |           63,157 |                0 |           62,179 |
|         49 |       ***** |1557154507198 |     479 |       32,261,944 |           63,157 |                0 |           60,884 |
|         50 |       ***** |1557154517198 |     489 |       32,261,944 |           63,157 |                0 |           59,641 |
|         51 |          19 |1557154527198 |     499 |       34,622,780 |           63,599 |           59,019 |           63,170 |
|         52 |          20 |1557154537199 |     509 |       36,858,014 |           64,719 |          223,501 |           66,314 |
|         53 |          21 |1557154547199 |     519 |       38,742,753 |           66,098 |          188,474 |           68,664 |
|         54 |       ***** |1557154557198 |     529 |       38,742,753 |           66,098 |                0 |           67,368 |


Rates did not improve. 


### Changed SparkJob

Change es.bash setting back.

```
/opt/spark/bin/spark-submit \
  --conf spark.executor.cores=5 \
  --conf spark.cores.max=45 \
  --conf spark.executor.memory=5000m \
  --conf spark.es.batch.size.bytes=421000000 \
  --conf spark.es.batch.size.entries=50000 \
  --conf spark.es.batch.write.refresh=false \
  --conf spark.streaming.concurrentJobs=64 \
  --conf spark.scheduler.mode=FAIR \
  --conf spark.locality.wait=0s  \
  --conf spark.streaming.kafka.consumer.cache.enabled=false \
  --class org.jennings.estest.SendKafkaTopicElasticsearch /home/spark/sparktest/target/sparktest-full.jar \
  spark://aks-nodepool1-64873208-9:7077 1000 aks-nodepool1-64873208-3:9092 group1 planes9 1 \
  aks-nodepool1-64873208-7 9200 - - 9 true false true planes 60s 10000 0 false
```


EIM: 159k/s at 1 min; 

|Query Number|Sample Number|Epoch (ms)    |Time (s) |Count             |Linear Reg. Rate  |Rate From Previous|Rate From First   |
|------------|-------------|--------------|---------|------------------|------------------|------------------|------------------|
|          1 |           1 |1557154827202 |       0 |        7,401,324 |                  |                  |                  |
|          2 |       ***** |1557154837230 |      10 |        7,401,324 |                  |                  |                  |
|          3 |       ***** |1557154847240 |      20 |        7,401,324 |                  |                  |                  |
|          4 |       ***** |1557154857256 |      30 |        7,401,324 |                  |                  |                  |
|          5 |       ***** |1557154867204 |      40 |        7,401,324 |                  |                  |                  |
|          6 |       ***** |1557154877202 |      50 |        7,401,324 |                  |                  |                  |
|          7 |           2 |1557154887202 |      60 |       11,244,158 |           64,047 |           64,047 |           64,047 |
|          8 |           3 |1557154897203 |      70 |       18,542,089 |          125,977 |          729,720 |          159,152 |
|          9 |       ***** |1557154907247 |      80 |       18,542,089 |          125,977 |                0 |          139,181 |
|         10 |       ***** |1557154917202 |      90 |       18,542,089 |          125,977 |                0 |          123,786 |
|         11 |       ***** |1557154927202 |     100 |       18,542,089 |          125,977 |                0 |          111,408 |
|         12 |       ***** |1557154937205 |     110 |       18,542,089 |          125,977 |                0 |          101,277 |
|         13 |       ***** |1557154947205 |     120 |       18,542,089 |          125,977 |                0 |           92,837 |
|         14 |           4 |1557154957204 |     130 |       22,510,307 |          119,831 |           66,136 |          116,221 |
|         15 |           5 |1557154967203 |     140 |       24,581,579 |          122,922 |          207,148 |          122,715 |
|         16 |       ***** |1557154977205 |     150 |       24,581,579 |          122,922 |                0 |          114,533 |
|         17 |       ***** |1557154987205 |     160 |       24,581,579 |          122,922 |                0 |          107,375 |
|         18 |       ***** |1557154997201 |     169 |       24,581,579 |          122,922 |                0 |          101,061 |
|         19 |       ***** |1557155007202 |     180 |       24,581,579 |          122,922 |                0 |           95,446 |
|         20 |       ***** |1557155017206 |     190 |       24,581,579 |          122,922 |                0 |           90,420 |
|         21 |           6 |1557155027203 |     200 |       30,107,187 |          116,925 |           92,093 |          113,529 |
|         22 |       ***** |1557155037203 |     210 |       30,107,187 |          116,925 |                0 |          108,123 |
|         23 |           7 |1557155047204 |     220 |       31,727,610 |          113,157 |           81,017 |          110,573 |
|         24 |       ***** |1557155057203 |     230 |       31,727,610 |          113,157 |                0 |          105,766 |
|         25 |       ***** |1557155067206 |     240 |       31,727,610 |          113,157 |                0 |          101,358 |
|         26 |       ***** |1557155077207 |     250 |       31,727,610 |          113,157 |                0 |           97,303 |
|         27 |           8 |1557155087221 |     260 |       32,464,330 |          102,793 |           18,410 |           96,389 |
|         28 |           9 |1557155097205 |     270 |       36,090,401 |          102,610 |          363,188 |          106,255 |
|         29 |       ***** |1557155107204 |     280 |       36,090,401 |          102,610 |                0 |          102,460 |
|         30 |          10 |1557155117203 |     290 |       37,847,626 |          102,087 |           87,870 |          104,987 |
|         31 |          11 |1557155127204 |     300 |       38,700,814 |          101,579 |           85,310 |          104,331 |
|         32 |       ***** |1557155137204 |     310 |       38,700,814 |          101,579 |                0 |          100,965 |
|         33 |       ***** |1557155147204 |     320 |       38,700,814 |          101,579 |                0 |           97,810 |
|         34 |          12 |1557155157204 |     330 |       40,000,000 |           99,281 |           43,306 |           98,783 |
|         35 |       ***** |1557155167205 |     340 |       40,000,000 |           99,281 |                0 |           95,878 |
|         36 |       ***** |1557155177206 |     350 |       40,000,000 |           99,281 |                0 |           93,138 |
|         37 |       ***** |1557155187207 |     360 |       40,000,000 |           99,281 |                0 |           90,551 |
|         38 |       ***** |1557155197204 |     370 |       40,000,000 |           99,281 |                0 |           88,104 |
|         39 |       ***** |1557155207204 |     380 |       40,000,000 |           99,281 |                0 |           85,786 |
|         40 |       ***** |1557155217205 |     390 |       40,000,000 |           99,281 |                0 |           83,586 |
|         41 |       ***** |1557155227204 |     400 |       40,000,000 |           99,281 |                0 |           81,496 |
|         42 |       ***** |1557155237205 |     410 |       40,000,000 |           99,281 |                0 |           79,508 |
|         43 |       ***** |1557155247203 |     420 |       40,000,000 |           99,281 |                0 |           77,616 |
|         44 |       ***** |1557155257212 |     430 |       40,000,000 |           99,281 |                0 |           75,809 |
|         45 |       ***** |1557155267205 |     440 |       40,000,000 |           99,281 |                0 |           74,087 |

For last 120  seconds the count has not increased...
Removing sample: 450|40000000
Total Count: 40,000,000 | Linear Regression Rate:  101,579 | Linear Regression Standard Error: 5.94 | Average Rate: 104,331

### Sending at 800k/s

Using two test server each sending 400k/s using two threads.

```
bash sendPlanes aks-nodepool1-64873208-3:9092 planes9 planes00000 200 40 2
```

Kafka Topic Monitor: 800k/s

ElasticIndexMon

|Query Number|Sample Number|Epoch (ms)    |Time (s) |Count             |Linear Reg. Rate  |Rate From Previous|Rate From First   |
|------------|-------------|--------------|---------|------------------|------------------|------------------|------------------|
|          1 |           1 |1557155447255 |       0 |        2,274,313 |                  |                  |                  |
|          2 |           2 |1557155457210 |       9 |        7,447,395 |          519,647 |          519,647 |          519,647 |
|          3 |       ***** |1557155467205 |      19 |        7,447,395 |          519,647 |                0 |          259,302 |
|          4 |       ***** |1557155477205 |      29 |        7,447,395 |          519,647 |                0 |          172,724 |
|          5 |       ***** |1557155487208 |      39 |        7,447,395 |          519,647 |                0 |          129,479 |
|          6 |       ***** |1557155497271 |      50 |        7,447,395 |          519,647 |                0 |          103,429 |
|          7 |       ***** |1557155507260 |      60 |        7,447,395 |          519,647 |                0 |           86,211 |
|          8 |           3 |1557155517216 |      69 |       14,463,679 |          154,205 |          116,926 |          174,231 |
|          9 |           4 |1557155527249 |      79 |       16,723,079 |          157,676 |          225,197 |          180,623 |
|         10 |       ***** |1557155537208 |      89 |       16,723,079 |          157,676 |                0 |          160,626 |
|         11 |       ***** |1557155547205 |      99 |       16,723,079 |          157,676 |                0 |          144,560 |
|         12 |       ***** |1557155557207 |     109 |       16,723,079 |          157,676 |                0 |          131,410 |
|         13 |       ***** |1557155567208 |     119 |       16,723,079 |          157,676 |                0 |          120,454 |
|         14 |           5 |1557155577207 |     129 |       17,567,567 |          114,735 |           16,904 |          117,684 |
|         15 |           6 |1557155587207 |     139 |       21,505,073 |          116,351 |          393,751 |          137,410 |
|         16 |           7 |1557155597247 |     149 |       22,176,631 |          115,538 |           66,888 |          132,689 |
|         17 |           8 |1557155607208 |     159 |       23,511,222 |          115,554 |          133,982 |          132,770 |
|         18 |       ***** |1557155617208 |     169 |       23,511,222 |          115,554 |                0 |          124,958 |
|         19 |       ***** |1557155627208 |     179 |       23,511,222 |          115,554 |                0 |          118,014 |
|         20 |       ***** |1557155637209 |     189 |       23,511,222 |          115,554 |                0 |          111,800 |
|         21 |           9 |1557155647211 |     199 |       24,839,363 |          107,242 |           33,201 |          112,850 |
|         22 |          10 |1557155657215 |     209 |       27,544,388 |          106,253 |          270,394 |          120,357 |
|         23 |          11 |1557155667207 |     219 |       29,857,005 |          107,733 |          231,447 |          125,403 |
|         24 |       ***** |1557155677212 |     229 |       29,857,005 |          107,733 |                0 |          119,947 |
|         25 |       ***** |1557155687207 |     239 |       29,857,005 |          107,733 |                0 |          114,951 |
|         26 |       ***** |1557155697258 |     250 |       29,857,005 |          107,733 |                0 |          110,329 |
|         27 |       ***** |1557155707209 |     259 |       29,857,005 |          107,733 |                0 |          106,106 |
|         28 |          12 |1557155717210 |     269 |       36,391,865 |          110,877 |          130,689 |          126,382 |
|         29 |          13 |1557155727257 |     280 |       37,711,405 |          112,880 |          131,337 |          126,560 |
|         30 |       ***** |1557155737210 |     289 |       37,711,405 |          112,880 |                0 |          122,216 |
|         31 |          14 |1557155747235 |     299 |       40,456,198 |          114,765 |          137,391 |          127,281 |
|         32 |       ***** |1557155757208 |     309 |       40,456,198 |          114,765 |                0 |          123,186 |
|         33 |       ***** |1557155767208 |     319 |       40,456,198 |          114,765 |                0 |          119,336 |
|         34 |          15 |1557155777208 |     329 |       42,631,788 |          114,683 |           72,585 |          122,313 |
|         35 |          16 |1557155787211 |     339 |       44,863,756 |          115,635 |          223,130 |          125,279 |
|         36 |       ***** |1557155797284 |     350 |       44,863,756 |          115,635 |                0 |          121,674 |
|         37 |          17 |1557155807208 |     359 |       46,604,506 |          115,836 |           87,051 |          123,156 |
|         38 |       ***** |1557155817210 |     369 |       46,604,506 |          115,836 |                0 |          119,826 |
|         39 |       ***** |1557155827211 |     379 |       46,604,506 |          115,836 |                0 |          116,672 |
|         40 |          18 |1557155837208 |     389 |       47,351,406 |          113,852 |           24,897 |          115,596 |
|         41 |          19 |1557155847294 |     400 |       51,223,168 |          114,327 |          383,875 |          122,360 |
|         42 |       ***** |1557155857223 |     409 |       51,223,168 |          114,327 |                0 |          119,397 |
|         43 |       ***** |1557155867221 |     419 |       51,223,168 |          114,327 |                0 |          116,554 |
|         44 |          20 |1557155877209 |     429 |       52,139,897 |          113,090 |           30,644 |          115,979 |
|         45 |          21 |1557155887231 |     439 |       54,062,544 |          112,648 |          191,843 |          117,707 |
|         46 |       ***** |1557155897210 |     449 |       54,062,544 |          112,648 |                0 |          115,096 |
|         47 |          22 |1557155907210 |     459 |       56,599,891 |          112,455 |          127,001 |          118,111 |
|         48 |          23 |1557155917209 |     469 |       58,041,934 |          112,457 |          144,219 |          118,666 |
|         49 |          24 |1557155927227 |     479 |       58,796,162 |          112,302 |           75,287 |          117,761 |
|         50 |       ***** |1557155937210 |     489 |       58,796,162 |          112,302 |                0 |          115,361 |
|         51 |          25 |1557155947251 |     499 |       59,574,073 |          111,584 |           38,849 |          114,600 |
|         52 |          26 |1557155957213 |     509 |       60,950,811 |          111,111 |          138,199 |          115,061 |
|         53 |          27 |1557155967214 |     519 |       61,543,095 |          110,550 |           59,222 |          113,987 |
|         54 |          28 |1557155977210 |     529 |       62,838,336 |          110,149 |          129,576 |          114,281 |
|         55 |       ***** |1557155987212 |     539 |       62,838,336 |          110,149 |                0 |          112,165 |
|         56 |          29 |1557155997236 |     549 |       63,704,867 |          109,392 |           43,270 |          111,696 |
|         57 |          30 |1557156007213 |     559 |       65,410,804 |          108,938 |          170,987 |          112,752 |
|         58 |          31 |1557156017217 |     569 |       67,510,280 |          108,826 |          209,864 |          114,457 |
|         59 |       ***** |1557156027213 |     579 |       67,510,280 |          108,826 |                0 |          112,484 |
|         60 |          32 |1557156037215 |     589 |       69,609,028 |          108,708 |          104,948 |          114,134 |
|         61 |       ***** |1557156047213 |     599 |       69,609,028 |          108,708 |                0 |          112,232 |
|         62 |       ***** |1557156057213 |     609 |       69,609,028 |          108,708 |                0 |          110,392 |
|         63 |          33 |1557156069047 |     621 |       70,653,318 |          107,964 |           32,806 |          109,971 |
|         64 |          34 |1557156077213 |     629 |       72,391,001 |          107,555 |          212,795 |          111,304 |
|         65 |          35 |1557156087215 |     639 |       75,306,530 |          107,630 |          291,495 |          114,120 |
|         66 |       ***** |1557156097216 |     649 |       75,306,530 |          107,630 |                0 |          112,364 |
|         67 |          36 |1557156107248 |     659 |       76,941,183 |          107,581 |           81,598 |          113,133 |
|         68 |          37 |1557156117214 |     669 |       77,750,764 |          107,483 |           81,234 |          112,658 |
|         69 |       ***** |1557156127215 |     679 |       77,750,764 |          107,483 |                0 |          111,001 |
|         70 |       ***** |1557156137214 |     689 |       77,750,764 |          107,483 |                0 |          109,393 |
|         71 |          38 |1557156147217 |     699 |       81,183,342 |          107,438 |          114,408 |          112,733 |
|         72 |       ***** |1557156157294 |     710 |       81,183,342 |          107,438 |                0 |          111,133 |
|         73 |       ***** |1557156167249 |     719 |       81,183,342 |          107,438 |                0 |          109,597 |
|         74 |          39 |1557156177217 |     729 |       83,267,714 |          107,160 |           69,479 |          110,956 |
|         75 |       ***** |1557156187215 |     739 |       83,267,714 |          107,160 |                0 |          109,456 |
|         76 |       ***** |1557156197216 |     749 |       83,267,714 |          107,160 |                0 |          107,997 |
|         77 |          40 |1557156207216 |     759 |       84,768,975 |          106,564 |           50,044 |          108,551 |
|         78 |          41 |1557156217216 |     769 |       86,665,152 |          106,221 |          189,618 |          109,604 |
|         79 |          42 |1557156227217 |     779 |       87,199,655 |          105,835 |           53,445 |          108,884 |
|         80 |          43 |1557156237217 |     789 |       88,153,199 |          105,487 |           95,354 |          108,713 |
|         81 |          44 |1557156247221 |     799 |       88,686,997 |          105,102 |           53,358 |          108,020 |
|         82 |       ***** |1557156257218 |     809 |       88,686,997 |          105,102 |                0 |          106,687 |
|         83 |       ***** |1557156267218 |     819 |       88,686,997 |          105,102 |                0 |          105,386 |
|         84 |          45 |1557156277246 |     829 |       89,707,263 |          104,414 |           33,981 |          105,342 |
|         85 |          46 |1557156287299 |     840 |       90,347,433 |          103,757 |           63,679 |          104,843 |
|         86 |          47 |1557156297218 |     849 |       91,703,661 |          103,230 |          136,730 |          105,216 |
|         87 |          48 |1557156307219 |     859 |       92,672,456 |          102,759 |           96,870 |          105,119 |
|         88 |          49 |1557156317219 |     869 |       93,100,908 |          102,266 |           42,845 |          104,403 |
|         89 |       ***** |1557156327221 |     879 |       93,100,908 |          102,266 |                0 |          103,216 |
|         90 |       ***** |1557156337220 |     889 |       93,100,908 |          102,266 |                0 |          102,056 |
|         91 |          50 |1557156347312 |     900 |       94,243,475 |          101,561 |           37,968 |          102,181 |
|         92 |          51 |1557156357221 |     909 |       94,832,572 |          100,887 |           59,451 |          101,716 |
|         93 |          52 |1557156367219 |     919 |       95,413,664 |          100,240 |           58,121 |          101,242 |
|         94 |          53 |1557156377220 |     929 |       97,269,516 |           99,757 |          185,567 |          102,149 |
|         95 |          54 |1557156387221 |     939 |       98,470,975 |           99,346 |          120,134 |          102,341 |
|         96 |       ***** |1557156397224 |     949 |       98,470,975 |           99,346 |                0 |          101,263 |
|         97 |       ***** |1557156407226 |     959 |       98,470,975 |           99,346 |                0 |          100,208 |
|         98 |          55 |1557156417221 |     969 |      101,179,503 |           98,931 |           90,284 |          101,968 |
|         99 |       ***** |1557156427220 |     979 |      101,179,503 |           98,931 |                0 |          100,927 |
|        100 |          56 |1557156437224 |     989 |      103,225,590 |           98,559 |          102,289 |          101,974 |
|        101 |          57 |1557156447223 |     999 |      106,845,625 |           98,490 |          362,040 |          104,575 |
|        102 |       ***** |1557156457224 |    1009 |      106,845,625 |           98,490 |                0 |          103,539 |
|        103 |       ***** |1557156467222 |    1019 |      106,845,625 |           98,490 |                0 |          102,524 |
|        104 |       ***** |1557156477224 |    1029 |      106,845,625 |           98,490 |                0 |          101,529 |
|        105 |          58 |1557156487225 |    1039 |      108,281,664 |           98,170 |           35,899 |          101,933 |
|        106 |          59 |1557156497223 |    1049 |      108,913,228 |           97,850 |           63,169 |          101,564 |
|        107 |          60 |1557156507223 |    1059 |      111,326,017 |           97,697 |          241,279 |          102,882 |


Observations: These rates are pretty close to what we got on CentOS VM's using the same tests.

In these test's the hard drive for Elasticsearch was using the default root drive (100G); the CentOS tests used a 1TB drive.  Larger drives are faster so with larger drives Ubuntu might do even better.




